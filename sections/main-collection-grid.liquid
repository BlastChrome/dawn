{{ 'slick-theme.css' | asset_url | stylesheet_tag }}
{{ 'slick.css' | asset_url | stylesheet_tag }}
<script src="{{ 'facets.js' | asset_url }}" defer="defer"></script>
<script src="{{ 'productCard.js' | asset_url }}" defer></script>

{%- style -%}
    .section-{{ section.id }}-padding {
      padding-top: {{ section.settings.padding_top | times: 0.75 | round: 0 }}px;
      padding-bottom: {{ section.settings.padding_bottom | times: 0.75 | round: 0 }}px;
    }

    @media screen and (min-width: 750px) {
      .section-{{ section.id }}-padding {
        padding-top: {{ section.settings.padding_top }}px;
        padding-bottom: {{ section.settings.padding_bottom }}px;
      }
    }
  {% if section.settings.view_all %}
    .view-all-wrapper{
      margin-top: 40px;
      width: 100%;
      display: flex;
      justify-content: center;
    }
  {% endif %}

    {% assign grid_columns = section.settings.columns_desktop %}
    .section-{{ section.id }} .product-slider--grid{
      display: grid;
      gap: 30px;
      padding: 0 15px;
      grid-template-columns: repeat({{ grid_columns }}, 1fr);
    }

    @media screen and (max-width: 991px) {
        .section-{{ section.id }} .product-slider--grid{
        grid-template-columns: repeat(2, 1fr);
      }
    }
    @media screen and (max-width: 767px) {
        .section-{{ section.id }} .product-slider--grid{
        grid-template-columns: repeat(1, 1fr);
      }
    }
{%- endstyle -%}

<section class="main-collection-grid section-{{ section.id }} section-{{ section.id }}-padding" id="{{section.id}}">
  <div class="container">
    <div class="row"></div>
  </div>
  <div class="{% if section.settings.full_width %} container-full {% else %} container {% endif %}">
    <div class="row">
      <div class="d-none d-md-block col-3 col-lg-2">
        <aside class="filter-sidebar">
          <!-- Filter Clear Button -->
          <div class="filter-clear">
            <button class="clear-btn">
              <span class="icon">X</span>
              <span class="text">Clear All Filters </span>
            </button>
          </div>

          <!-- Categories -->
          <div class="filter-group">
            <h3>Categories</h3>
            <ul>
              <li>
                <div class="checkboxWrapper">
                  <input type="checkbox" id="new-in">
                  <div class="checkmark">
                    <span class="icon">{{ 'filter-checkmark.svg' | inline_asset_content }}</span>
                  </div>
                  <label for="new-in">New in Closet (50)</label>
                </div>
              </li>
              <li>
                <div class="checkboxWrapper">
                  <input type="checkbox" id="featured-items">
                  <div class="checkmark">
                    <span class="icon">{{ 'filter-checkmark.svg' | inline_asset_content }}</span>
                  </div>
                  <label for="featured-items">Featured Items (150)</label>
                </div>
              </li>
              <li>
                <div class="checkboxWrapper">
                  <input type="checkbox" id="mens-shoes">
                  <div class="checkmark">
                    <span class="icon">{{ 'filter-checkmark.svg' | inline_asset_content }}</span>
                  </div>
                  <label for="mens-shoes">Men's Shoes (220)</label>
                </div>
              </li>
              <li>
                <div class="checkboxWrapper">
                  <input type="checkbox" id="womens-shoes">
                  <div class="checkmark">
                    <span class="icon">{{ 'filter-checkmark.svg' | inline_asset_content }}</span>
                  </div>
                  <label for="womens-shoes">Women's Shoes (350)</label>
                </div>
              </li>
              <li>
                <div class="checkboxWrapper">
                  <input type="checkbox" id="kids-shoes">
                  <div class="checkmark">
                    <span class="icon">{{ 'filter-checkmark.svg' | inline_asset_content }}</span>
                  </div>
                  <label for="kids-shoes">Kids Shoes (120)</label>
                </div>
              </li>
              <li>
                <div class="checkboxWrapper">
                  <input type="checkbox" id="sports-shoes">
                  <div class="checkmark">
                    <span class="icon">{{ 'filter-checkmark.svg' | inline_asset_content }}</span>
                  </div>
                  <label for="sports-shoes">Sports Shoes (80)</label>
                </div>
              </li>
              <li>
                <div class="checkboxWrapper">
                  <input type="checkbox" id="sports-equipment">
                  <div class="checkmark">
                    <span class="icon">{{ 'filter-checkmark.svg' | inline_asset_content }}</span>
                  </div>
                  <label for="sports-equipment">Sports Equipmnet (70)</label>
                </div>
              </li>
            </ul>
          </div>
          <div class="horizontal-line"></div>

          <!-- Brands -->
          <div class="filter-group">
            <h3>Brands</h3>
            <ul>
              <li>
                <div class="checkboxWrapper">
                  <input type="checkbox" id="brand-nike">
                  <div class="checkmark">
                    <span class="icon">{{ 'filter-checkmark.svg' | inline_asset_content }}</span>
                  </div>
                  <label for="brand-nike">Nike (430)</label>
                </div>
              </li>
              <li>
                <div class="checkboxWrapper">
                  <input type="checkbox" id="brand-puma">
                  <div class="checkmark">
                    <span class="icon">{{ 'filter-checkmark.svg' | inline_asset_content }}</span>
                  </div>
                  <label for="brand-puma">Puma (320)</label>
                </div>
              </li>
              <li>
                <div class="checkboxWrapper">
                  <input type="checkbox" id="brand-adidas">
                  <div class="checkmark">
                    <span class="icon">{{ 'filter-checkmark.svg' | inline_asset_content }}</span>
                  </div>
                  <label for="brand-adidas">Adidas (300)</label>
                </div>
              </li>
              <li>
                <div class="checkboxWrapper">
                  <input type="checkbox" id="brand-reebok">
                  <div class="checkmark">
                    <span class="icon">{{ 'filter-checkmark.svg' | inline_asset_content }}</span>
                  </div>
                  <label for="brand-reebok">Reebok (280)</label>
                </div>
              </li>
              <li>
                <div class="checkboxWrapper">
                  <input type="checkbox" id="brand-skechers">
                  <div class="checkmark">
                    <span class="icon">{{ 'filter-checkmark.svg' | inline_asset_content }}</span>
                  </div>
                  <label for="brand-skechers">Skechers (100)</label>
                </div>
              </li>
            </ul>
          </div>
          <div class="horizontal-line"></div>

          <!-- Sizes -->
          <div class="filter-group">
            <h3>Sizes (US)</h3>
            <div class="filter-group__buttons">
              <button class="button button--outline active"><span>4</span></button>
              <button class="button button--outline"><span>5</span></button>
              <button class="button button--outline"><span>6</span></button>
              <button class="button button--outline"><span>7</span></button>
              <button class="button button--outline"><span>8</span></button>
              <button class="button button--outline"><span>9</span></button>
              <button class="button button--outline"><span>10</span></button>
              <button class="button button--outline"><span>11</span></button>
              <button class="button button--outline"><span>12</span></button>
            </div>
          </div>
          <div class="horizontal-line"></div>

          <!-- Price Range -->
          <div class="filter-group">
            <h3>Price</h3>
            <div class="range">
              <!-- Slider -->
              <div class="range__slider">
                <div class="range__track"></div>
                <input
                  class="range__slide-input range__slide-input--min"
                  type="range"
                  class="min-range"
                  min="50"
                  max="1000"
                  value="50"
                  step="1"
                >
                <input
                  class="range__slide-input range__slide-input--max"
                  type="range"
                  class="min-range"
                  min="50"
                  max="1000"
                  value="50"
                  step="1"
                >
              </div>
              <div class="range__number">
                <div class="input-group">
                  <label for="min-price">Min. Price</label>
                  <input type="number" name="min-price" id="min-price">
                </div>
                <div class="input-group">
                  <label for="max-price">Max. Price</label>
                  <input type="number" name="max-price" id="max-price">
                </div>
              </div>
            </div>
          </div>
          <div class="horizontal-line"></div>

          {% if section.settings.show_ad != 'blank' %}
            <a href="#">
              <div class="advertisement advertisement--vertical">
                <div class="img">
                  <img
                    src="{{ section.settings.image_ad | img_url: 'master' }}"
                    alt="advertisement"
                    width="100%"
                    height="auto"
                  >
                </div>
                <div class="advertisement__text">
                  <h3>Nike Shoes</h3>
                  {% render 'button', button_text: 'Buy Now', button_link: '#', button_class: 'button--primary' %}
                </div>
              </div>
            </a>
          {% endif %}
        </aside>
      </div>
      <div class="col-12 col-lg-10">
        <div class="row">
          <div class="col-12 title-category-col">
            {% assign collection_one = collections[section.settings.product_collection_one] %}
            <p class="results-summary">Showing 1 of 150 results.</p>
            <facet-filters-form>
              <form id="facet-sort-form">
                <div class="sort-by">
                  <label for="sort-by-select" class="sort-by-label">Sort By</label>
                  <div class="vert-line"></div>
                  <select name="sort-by-select" id="sort-by-select" class="sort-by-select">
                    <option value="featured">Featured</option>
                    <option value="latest">Latest</option>
                    <option value="price-high">Price: High to low</option>
                    <option value="price-low">Price: Low to high</option>
                  </select>
                </div>
              </form>
            </facet-filters-form>
          </div>
        </div>
        <div class="row">
          <div class="col-12">
            <div class="product-tabs__separator product-tabs__separator--horizontal"></div>
            <div class="product-slider-wrapper">
              <div class="product-slider  product-slider--grid">
                {% if section.settings.product_collection_one %}
                  {% assign collection = collections[section.settings.product_collection_one] %}
                {% endif %}
                {% if collection %}
                  {% for product in collection.products limit: section.settings.total_products_to_show %}
                    {% if section.settings.show_secondary_image == true %}
                      {% assign image_two = product.media[1] %}
                    {% endif %}
                    {%
                      render 'product-card',
                      product_form: product,
                      product_varient_id: product.variants.first.id,
                      product_card_image: product.featured_media | default: product.featured_image,
                      product_card_image_two: image_two,
                      product_card_category: product.type,
                      product_card_title: product.title,
                      product_card_price: product.price,
                      product_card_url: product.url
                    %}
                  {% endfor %}
                {% endif %}
              </div>
            </div>
          </div>
        </div>
        {% if section.settings.view_all %}
          {% assign view_all_class = 'button--' | append: section.settings.view_all_style %}
          <div class="row">
            <div class="col-xs-12">
              <div class="view-all-wrapper">
                {% render 'button',
                  button_text: 'View All',
                  button_link: collection.url,
                  button_class: view_all_class
                %}
              </div>
            </div>
          </div>
        {% endif %}
      </div>
    </div>
  </div>
</section>

<script>
// Encapsulate the section logic inside IIFE
    (function(){

          function handleProductLayout(products,layoutElement){
            // Clear the contents of the wrapper
            $(layoutElement).empty();

            // if the number of products is less than the max set in the admin, set the limit to length of products array
            let limit = 0
            products.length < {{ section.settings.total_products_to_show }}
              ? limit = products.length
              : limit = {{ section.settings.total_products_to_show }}

              // Loop through the products and render them in the product slider, 
             for(let i = 0; i < limit; i++){
                    const product = products[i];
                    // query the relevant product info
                    const first_varient_id = product.variants[0].id;
                    const first_varient_price = product.variants[0].price;
                    const product_title = product.title;
                    const product_featured_image = product.images[0].src;
                    const product_url = `/products/${product.handle}`
                    {% if section.settings.show_secondary_image == true %}
                    const product_secondary_image = product.images[1].src;
                    {% endif %}
                    const product_category = product.product_type;
             
                    // re-construct the product card html
                    const productHTML = `
                        <product-card class="product-card" data-slick="slide">
                          <form action="/cart/add.js" method="post" class="product-card__form">
                            <!-- Hidden input for variant ID -->
                            <input type="hidden" name="id" value="${first_varient_id}">
                            <div class="product-card__actions {% if section.settings.show_secondary_image == blank %} image-single {%endif %}">
                              <div class="product-card__actions--image">
                               <div class="img-wrapper {% if section.settings.show_secondary_image %} img-wrapper--one {% endif %}">
                                <a href="${product_url}">
                                  <img
                                    src="${product_featured_image}"
                                    alt="${product_title}"
                                    width="748"
                                    height="610"
                                  >
                                </a>
                              </div>
                           {% if section.settings.show_secondary_image %}
                               <div class="img-wrapper img-wrapper--two">
                                 <a href="${product_url}">
                                   <img
                                     src="${product_secondary_image}"
                                     alt=""
                                     width="748"
                                     height="610"
                                   >
                                 </a>
                               </div>
                             {% endif %} 
                              </div>
                              
                               <button type="submit" class="product-card__actions--cart">
                                  <span id="btn-text" class="actions__btn-text">Add to Cart</span>
                                 <span id="loader-spinner" class="loader-spinner"></span>
                               </button>
             
                              <div class="product-card__actions-group">
                                <button class="product-card__action product-card__action--favorite">
                                 {{ 'product-card-favorite.svg' | inline_asset_content }}
                                </button>
                                <button class="product-card__action product-card__action--share">
                                 {{ 'product-card-share.svg' | inline_asset_content }}
                                </button>
                                <button class="product-card__action product-card__action--zoom">
                                 {{ 'product-card-zoom.svg' | inline_asset_content }}
                                </button>
                              </div>
                            </div>
             
                            <div class="product-card__details">
                              <h3 class="product-card__category">${product_category}</h3>
                              <h2 class="product-card__title">${product_title}</h2>
                              <p class="product-card__price">$${first_varient_price}</p>
                            </div>
                          </form>
                        </product-card>
                    `;
                  $(layoutElement).append(productHTML); 
            }
          }

          function handleSelectField(){
                // Select all tabs within the product grid section
                const select = document.querySelector('.section-{{ section.id }} #sort-by-select');
                select.addEventListener("change", async (e) => {
                  // get the vendor value from the from the option tag
                  const vendor = e.target.value; 

                  // fetch all the products from the current collection
                  const res = await fetch(`/collections/{{section.settings.product_collection_one}}/products.json`);
                  const collection = await res.json();
                  const products = collection.products;

                  //filter the products to the selected vendor 
                  const filteredProducts = products.filter(product => product.vendor == vendor)
                  handleProductLayout(filteredProducts,'#{{ section.id }} .product-slider--grid')
                })
          }
        
          // re-initialize the grid in the editor
          document.addEventListener('shopify:section:load', function () {
            handleSelectField()
          });
        
          // initial setup for the section
          document.addEventListener('DOMContentLoaded', function () {
            handleSelectField()
          });
    })()
</script>

{% schema %}
{
  "name": "Main Collection Grid",
  "settings": [
    {
      "type": "header",
      "content": "Section Padding"
    },
    {
      "type": "range",
      "id": "padding_top",
      "min": 0,
      "max": 200,
      "step": 4,
      "unit": "px",
      "label": "Padding Top",
      "default": 40
    },
    {
      "type": "range",
      "id": "padding_bottom",
      "min": 0,
      "max": 200,
      "step": 4,
      "unit": "px",
      "label": "Padding Bottom",
      "default": 40
    },
    {
      "type": "checkbox",
      "id": "show_ad",
      "label": "Show advertisement"
    },
    {
      "type": "image_picker",
      "id": "image_ad",
      "label": "Advertisement",
      "info": "Recommended image size: 748x610px"
    },
    {
      "type": "header",
      "content": "Collections"
    },
    {
      "type": "collection",
      "id": "product_collection_one",
      "label": "Product Collection"
    },
    {
      "type": "checkbox",
      "id": "view_all",
      "label": "Enable View All Button",
      "default": false
    },
    {
      "type": "select",
      "id": "view_all_style",
      "label": "View View All Style",
      "options": [
        {
          "value": "outline",
          "label": "Outline"
        },
        {
          "value": "solid",
          "label": "Solid"
        },
        {
          "value": "link",
          "label": "Link"
        }
      ],
      "default": "solid"
    },
    {
      "type": "range",
      "label": "Number of Columns (Desktop)",
      "id": "columns_desktop",
      "min": 3,
      "max": 6,
      "step": 1,
      "default": 4
    },
    {
      "type": "range",
      "label": "Products To Show",
      "id": "total_products_to_show",
      "min": 3,
      "max": 16,
      "step": 1,
      "default": 8
    },
    {
      "type": "checkbox",
      "id": "full_width",
      "label": "Enable Full Width",
      "default": false
    },
    {
      "type": "header",
      "content": "Product Image Options"
    },
    {
      "type": "checkbox",
      "id": "show_secondary_image",
      "default": false,
      "label": "Show secondary image on hover"
    }
  ]
}
{% endschema %}
